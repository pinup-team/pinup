<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/html">
<head>
    <meta charset="UTF-8">
    <title>Profile</title>
</head>
<body>
<th:block th:if="${session.userInfo == null}">
    <p>잘못된 접근입니다.</p>
</th:block>
<th:block th:if="${session.userInfo != null}">
    <form th:action="@{/users}" th:object="${profile}" method="post">
    <table class="table">
        <tbody>
        <tr>
            <td>이름</td>
            <td><input type="text" th:field="*{name}" readonly></td>
        </tr>
        <tr>
            <td>이메일</td>
            <td><input type="text" th:field="*{email}" readonly></td>
        </tr>
        <tr>
            <td>닉네임</td>
            <td><input type="text" th:field="*{nickname}" id="nickname"></td>
        </tr>
        <tr>
            <td>가입경로</td>
            <td><input type="text" th:field="*{providerType}" readonly></td>
        </tr>
        <tr>
            <td>권한</td>
            <td><input type="text" th:field="*{role}" readonly></td>
        </tr>
        </tbody>
    </table>
    <button type="submit">수정</button>
    </form>
    <button type="button" onclick="deleteAccount()">탈퇴</button>
</th:block>
<form action="/" method="get">
    <button type="submit">홈으로 돌아가기</button>
</form>
</body>
</html>
<script th:inline="javascript">
    var profile = [[${profile}]];
    console.log("Profile data:", profile);
    console.log("JSON.stringify(profile)", JSON.stringify(profile));


    function deleteAccount() {
        fetch('/users', {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(profile)
        })
            .then(response => {
                if (response.redirected) {
                    window.location.href = response.url;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('서버와의 연결에 실패했습니다.');
            });
    }
</script>

