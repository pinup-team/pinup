<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/main}">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"/>
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <link rel="stylesheet" th:href="@{/css/member.css}">
    <title>Pin-up</title>
</head>
<body>
<div layout:fragment="content">

    <div th:class="page_description">
        <h1>Popular</h1>
<!--        <a th:href="@{/about}" th:class="info-link">ğŸ¤” í•€ì—…ì€ ì–´ë–»ê²Œ ì´ìš©í•˜ë‚˜ìš”?</a>-->
        <div class="title-container">
            <div class="title-left">
                <h4>ê°€ì¥ ì¸ê¸° ìˆëŠ” íŒì—… ìŠ¤í† ì–´</h4>
            </div>
            <a th:href="@{/stores}" class="more-link">ë”ë³´ê¸°ğŸ‘‰</a>
        </div>
    </div>
    <div>
        <div class="store-list-container">
            <ul id="store-list">
            </ul>
        </div>
    </div>
</div>
</body>
</html>
<script>
    async function fetchStoreSummaries() {
        try {
            const response = await fetch('/api/stores');

            if (!response.ok) {
                throw new Error('ë„¤íŠ¸ì›Œí¬ ì‘ë‹µì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
            }

            const stores = await response.json();
            const storeListElement = document.getElementById('store-list');

            const topStores = stores.slice(0, 5);
            // ë¦¬ìŠ¤íŠ¸ì— íŒì—…ìŠ¤í† ì–´ ì¶”ê°€
            topStores.forEach(store => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `<div class="store-card">
                                        <img src="${store.imageUrl}" alt="Loading Image"
                                            onerror="this.onerror=null; this.src='/images/loading.png';">
                                        <div class="list-store-info">
                                            <div class="list-store-info-head">
                                                <h3>${store.name}</h3>
                                                <span>ğŸ“${store.location.district}</span>
                                            </div>
                                            <span class="list-store-info-date">~ ${store.endDate}</span>
                                        </div>
                                      </div>`;

                listItem.querySelector('.store-card').addEventListener('click', () => {
                    window.location.href = `/stores/${store.id}`;
                });
                storeListElement.appendChild(listItem);
            });
        } catch (error) {
            console.error('íŒì—…ìŠ¤í† ì–´ ëª©ë¡ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
        }
    }

    // í˜ì´ì§€ê°€ ë¡œë“œë˜ë©´ íŒì—…ìŠ¤í† ì–´ ëª©ë¡ì„ ê°€ì ¸ì˜´
    document.addEventListener('DOMContentLoaded', fetchStoreSummaries);
</script>