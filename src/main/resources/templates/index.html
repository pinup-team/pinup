<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/main}">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"/>
    <link rel="stylesheet" th:href="@{/css/main.css}">
    <link rel="stylesheet" th:href="@{/css/member.css}">
    <title>Pin-up</title>
</head>
<body>
<div layout:fragment="content">

    <div th:class="page_description">
        <h1>Popular</h1>
<!--        <a th:href="@{/about}" th:class="info-link">🤔 핀업은 어떻게 이용하나요?</a>-->
        <div class="title-container">
            <div class="title-left">
                <h4>가장 인기 있는 팝업 스토어</h4>
            </div>
            <a th:href="@{/stores}" class="more-link">더보기👉</a>
        </div>
    </div>
    <div>
        <div class="store-list-container">
            <ul id="store-list">
            </ul>
        </div>
    </div>
</div>
</body>
</html>
<script>
    async function fetchStoreSummaries() {
        try {
            const response = await fetch('/api/stores');

            if (!response.ok) {
                throw new Error('네트워크 응답이 올바르지 않습니다.');
            }

            const stores = await response.json();
            const storeListElement = document.getElementById('store-list');

            const topStores = stores.slice(0, 5);
            // 리스트에 팝업스토어 추가
            topStores.forEach(store => {
                const listItem = document.createElement('li');
                listItem.innerHTML = `<div class="store-card">
                                        <img src="${store.imageUrl}" alt="Loading Image"
                                            onerror="this.onerror=null; this.src='/images/loading.png';">
                                        <div class="list-store-info">
                                            <div class="list-store-info-head">
                                                <h3>${store.name}</h3>
                                                <span>📍${store.location.district}</span>
                                            </div>
                                            <span class="list-store-info-date">~ ${store.endDate}</span>
                                        </div>
                                      </div>`;

                listItem.querySelector('.store-card').addEventListener('click', () => {
                    window.location.href = `/stores/${store.id}`;
                });
                storeListElement.appendChild(listItem);
            });
        } catch (error) {
            console.error('팝업스토어 목록을 가져오는 중 오류 발생:', error);
        }
    }

    // 페이지가 로드되면 팝업스토어 목록을 가져옴
    document.addEventListener('DOMContentLoaded', fetchStoreSummaries);
</script>