<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head>
    <meta charset="UTF-8">
    <title>Posts List</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css"/>

    <link rel="stylesheet" th:href="@{/css/common.css}">
    <link rel="stylesheet" th:href="@{/css/post_list.css}">
    <link rel="stylesheet" th:href="@{/css/post_modal.css}">
</head>
<body>
<div class="wrap type_home" style="width: 95%;">
    <div class="content">
        <div class="post_content_wrap">
            <div class="content_list">
                <div class="content_list_area">
                    <div class="content_title">
                        <strong>Ïû•ÏÜåÏôÄ Ï∑®Ìñ•Ïù¥ Î∞úÍ≤¨ÎêòÎäî Í≥µÍ∞Ñ</strong>
                        <th:block sec:authorize="isAuthenticated()">
                            <button type="button" class="img_icon_keep"
                                    th:onclick="|location.href='/post/create?storeId=' + ${storeId}|">ÏûëÏÑ±
                            </button>
                        </th:block>
                        <th:block sec:authorize="!isAuthenticated()">
                            <button type="button" class="img_icon_keep"
                                    th:onclick="|location.href='/members/login'|">Î°úÍ∑∏Ïù∏ ÌõÑ ÏûëÏÑ±
                            </button>
                        </th:block>
                    </div>
                    <div class="list_pinup_top">
                        <div class="pinup_list_wrap">
                            <div class="pinup_list">
                                <th:block th:each="post : ${posts}">
                                    <div class="pinup_list_item">
                                        <div class="pinup_img_wrap"
                                             th:attr="onclick='openDetailPopup(' + ${post.id} + ')'">
                                            <img alt="ÌÖåÏä§Ìä∏Ïù¥ÎØ∏ÏßÄ" class="img_thumb" th:src="@{${post.thumbnail}}"/>
                                        </div>
                                        <div class="pinup_content">
                                            <h3 class="pinup_title" th:text="${post.title}"></h3>
                                            <div class="post_sub_info">
                                                <span class="post_date"
                                                      th:text="*{#temporals.format(post.createdAt, 'yyyy-MM-dd')}"></span>
                                                <span class="post_separator">¬∑</span>
                                                <span class="comment_meta">üí¨ <span
                                                        th:text="${post.commentCount}"></span></span>
                                                <span class="post_separator">¬∑</span>
                                                <span class="like_meta" th:data-post-id="${post.id}">
                                                  <button class="like-button transparent-button"
                                                          type="button"
                                                          data-readonly="true"
                                                          aria-disabled="true"
                                                          title="ÏÉÅÏÑ∏ÏóêÏÑú Ï¢ãÏïÑÏöî Í∞ÄÎä• (ÌÅ¥Î¶≠ Ïãú ÏÉÅÏÑ∏ Ïó¥Î¶º)">
                                                    <span th:text="${post.likedByCurrentUser} ? '‚ù§Ô∏è' : 'ü§ç'"></span>
                                                  </button>
                                                  <span class="like-count" th:text="${post.likeCount}"></span>
                                                </span>
                                            </div>
                                        </div>
                                        <div class="post_action_wrapper">
                                            <span class="pinup_nickname" th:text="${post.member.nickname}"></span>
                                            <th:block sec:authorize="isAuthenticated()">
                                                <button class="post_edit_button"
                                                        th:onclick="|location.href='@{/post/update/{postId}(postId=${post.id})}'|"
                                                        th:if="${post.member != null and post.member.nickname != null and #authentication.principal.username == post.member.nickname}">
                                                    ÏàòÏ†ï
                                                </button>
                                                <button class="post_delete_button"
                                                        th:onclick="disablePost([[${post.id}]], [[${storeId}]])"
                                                        th:if="${post.member != null and post.member.nickname != null and #authentication.principal.username == post.member.nickname
                                                        or #authentication.authorities.?[authority == 'ROLE_ADMIN'].size() > 0}">
                                                    ÏÇ≠Ï†ú
                                                </button>
                                            </th:block>
                                        </div>
                                    </div>
                                </th:block>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="detailModal" class="modal">
            <div class="modal-content">
                <div id="detailContainer">Î°úÎî© Ï§ë...</div>
            </div>
        </div>
    </div>
</div>

<th:block th:replace="~{fragments/script-loader :: load('post')}"></th:block>
</body>
</html>